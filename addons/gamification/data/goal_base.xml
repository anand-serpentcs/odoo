<odoo>
    <!-- Mail template is done in a NOUPDATE block
         so users can freely customize/delete them -->
    <data noupdate="1">
        <!--Email template -->
        
        <record id="email_template_goal_reminder" model="mail.template">
            <field name="name">Reminder for Goal Update</field>
            <field name="model_id" ref="gamification.model_gamification_goal"/>
            <field name="lang">${object.user_id.lang}</field>
            <field name="body_html" type="html">
    <p>
        <strong>Reminder <t t-value="record.name"/></strong>
    </p>
    
    <p>You have not updated your progress for the goal <span t-field="record.definition_id.name"/> (currently reached at <span t-field="record.completeness"/>%) for at least <span t-field="record.remind_update_delay"/> days. Do not forget to do it.</p>
            </field>
        </record>
        
        <record id="simple_report_template" model="mail.template">
            <field name="name">Simple Challenge Report Progress</field>
            <field name="model_id" ref="gamification.model_gamification_challenge"/>
            <field name="body_html" type="html"> 
            <meta charset="utf-8"/>
<t t-set="records" t-value="ctx.get('record')"/>
<t t-set="company" t-value="records and records.company_id or user.company_id"/>
<t t-set="challenge_lines" t-value="ctx.get('challenge_lines', [])"/>
<table cellspacing="0" cellpadding="0" width="100%" style="font-family: 'Helvetica'; background-color: #EEE; border-collapse: collapse;">
<tr>
    <td valign="top" align="center">
        <table cellspacing="0" cellpadding="0" width="600" style="margin: 0 auto; width: 600px;">
            <tr><td>
                <table cellspacing="0" cellpadding="0" width="100%">
                    <tr>
                        <td valign="middle" align="left" style="padding:30px 15px;">
                            <img width="90" t-attf-src="/logo.png?company=#{user.company_id.id}" style="width:80px;"/>
                        </td>
                        <t t-if="record.visibility_mode == 'ranking'">
                            <td style="padding:15px;">
                                <p style="font-size:20px;color:#666666;" align="right">Leaderboard</p>
                            </td>
                        </t>
                    </tr>
                </table>
                <table cellspacing="0" cellpadding="0" width="100%" bgcolor="#fff" style="background-color:#fff;">
                    <tr><td style="padding: 15px;">
                            <t t-if="record.visibility_mode == 'personal'">
                                <span style="color:#666666;font-size:13px;">Here is your current progress in the challenge <strong t-esc="record.name"/>.
                                </span>
                                <table cellspacing="0" cellpadding="0" width="100%" style="margin-top:20px;">
                                    <tr>
                                        <td align="center">
                                            <p style="font-size:27px;color:#666666;">Personal Performance</p>
                                        </td>
                                    </tr>
                                </table>
                                <table cellspacing="0" cellpadding="0" width="100%" style="margin-top:30px;color:#666666;">
                                    <thead>
                                        <tr style="color:#9A6C8E; font-size:12px;">
                                            <th align="left" style="padding-bottom: 0px;width:40%;text-align:left;">Goals</th>
                                            <th style="width:20%;text-align:right;" align="left">Target</th>
                                            <th style="width:20%;text-align:right;" align="right">Current</th>
                                            <th style="width:20%;text-align:right;" align="right">Completeness</th>
                                        </tr>
                                        <tr>
                                            <td colspan="5" style="height:1px;background-color:#9A6C8E;"></td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="challenge_lines" t-as="line">
                                            <tr t-if="line['completeness'] &gt;= 100" style="font-weight:bold;">
                                                <td style="padding: 20px 0;" align="left">
                                                    <t t-esc="line['name']"/>
                                                    <t t-if="line['suffix'] or line['monetary']">
                                                        <t t-esc="line['full_suffix']"/>
                                                    </t>
                                                </td>
                                                <td style="padding: 20px 0;" align="right"><t t-esc="'%.2f' % line['target']"/>
                                                    <t t-if="line['suffix']">
                                                        <t t-esc="line['suffix']"/>
                                                    </t>
                                                </td>
                                                <td style="padding: 20px 0;" align="right"><t t-esc="'%.2f' % line['current']"/>
                                                    <t t-if="line['suffix']">
                                                        <t t-esc="line['suffix']"/>
                                                    </t>
                                                </td>
                                                <td style="padding: 20px 0;font-size:25px;color:#9A6C8E;" align="right"><strong><t t-esc="line['completeness'] | int"/>%</strong></td>
                                            </tr>
                                            <tr>
                                                <td colspan="5" style="height:1px;background-color:#e3e3e3;"></td>
                                            </tr>
                                        </t>        
                                    </tbody>
                                </table>
                            </t>              
                            <t t-else="">
                                <span style="color:#A8A8A8;font-size:13px;">
                                    The following message contains the current progress for the challenge <strong><t t-esc="record.name"/></strong>.
                                </span>
                            </t>
                            <t t-foreach="challenge_lines" t-as="line">
                                <!-- Header + Button table -->
                                <table cellspacing="0" cellpadding="0" width="100%" style="margin-top:35px;">
                                    <tr>
                                        <td width="50%">
                                            <p style="font-size:22px;color:#666666;">Top Achievers for goal <strong><t t-esc="line['name']"/></strong></p>
                                        </td>
                                    </tr>
                                </table>
                                <!-- Podium -->
                                <t t-if="len(line['goals']) &gt; 2">
                                    <table cellspacing="0" cellpadding="0" width="100%" style="margin-top:10px;">
                                        <tr><td style="padding:0 30px;">
                                            <table cellspacing="0" cellpadding="0" width="100%">
                                                <tr>
                                                    <t t-set="top_goals" t-value="[line['goals'][1], line['goals'][0], line['goals'][2]]"/>
                                                    <t t-foreach="top_goals" t-as="goal">
                                                        <td align="center" style="width:32%;">
                                                            <t t-if="loop.index == 1">
                                                                <t t-set="extra_div" t-value="'&lt;div style=&quot;height:40px;&quot;&gt;&lt;/div&gt;'"/>
                                                                <t t-set="heightA" t-value="95"/>
                                                                <t t-set="heightB" t-value="75"/>
                                                                <t t-set="bgColor" t-value="'&#35;b898b0'"/>
                                                                <t t-set="fontSize" t-value="50"/>
                                                                <t t-set="podiumPosition" t-value="2"/>
                                                            </t>
                                                            <t t-elif="loop.index == 2">
                                                                <t t-set="extra_div" t-value="''"/>
                                                                <t t-set="heightA" t-value="55"/>
                                                                <t t-set="heightB" t-value="115"/>
                                                                <t t-set="bgColor" t-value="'&#35;9A6C8E'"/>
                                                                <t t-set="fontSize" t-value="85"/>
                                                                <t t-set="podiumPosition" t-value="1"/>
                                                            </t>
                                                            <t t-elif="loop.index == 3">
                                                                <t t-set="extra_div" t-value="'&lt;div style=&quot;height:60px;&quot;&gt;&lt;/div&gt;'"/>
                                                                <t t-set="heightA" t-value="115"/>
                                                                <t t-set="heightB" t-value="55"/>
                                                                <t t-set="bgColor" t-value="'&#35;c8afc1'"/>
                                                                <t t-set="fontSize" t-value="35"/>
                                                                <t t-set="podiumPosition" t-value="3"/>
                                                            </t>
                                                            <div style="margin:0 3px 0 3px;height:220px;">
                                                                <div t-attf-style="height:#{heightA}px;">
                                                                    <t t-esc="extra_div"/>
                                                                    <div style="height:55px;">
                                                                        <img style="margin-bottom:5px;width:50px;height:50px;border-radius:50%;" t-attf-src="/web/image?model=res.users&amp;field=image_small&amp;id=#{goal['user_id']}" alt=""/>
                                                                    </div> 
                                                                    <div align="center" t-attf-style ="color:#{bgColor};">
                                                                        <t t-esc="goal['name']"/>
                                                                    </div> 
                                                                </div>
                                                                <div t-attf-style="background-color:#{bgColor | safe};height:#{heightB}px;">
                                                                    <strong><span t-attf-style="color:#fff;font-size:#{fontSize}px;"><t t-esc="podiumPosition"/></span></strong>
                                                                </div>
                                                                <div style="height:30px;">
                                                                    <p style="color:#9A6C8E;font-size:20px;margin-top:10px;">
                                                                        <t t-esc="'%.2f' % goal['current']"/>
                                                                        <t t-if="line['suffix'] or line['monetary']">
                                                                            <t t-esc="line['full_suffix']"/>
                                                                        </t>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </t>
                                                </tr>
                                            </table>
                                            </td>
                                        </tr>
                                    </table>
                                </t>
                                <!-- data table -->
                                <table cellspacing="0" cellpadding="0" width="100%" style="margin-bottom:5px">
                                    <tr>
                                        <td>
                                            <table cellspacing="0" cellpadding="0" width="100%" style="margin-top:30px;margin-bottom:5px;color:#666666;">
                                                <thead>
                                                    <tr style="color:#9A6C8E; font-size:12px;">
                                                        <th style="width:10%;text-align:center;">Rank</th>
                                                        <th style="width:15%;text-align:left;">Name</th>
                                                        <th style="width:30%;text-align:right;">Performance
                                                            <t t-if="line['suffix']">
                                                                <t t-esc="line['suffix']"/>
                                                            </t>
                                                            <t t-elif="line['monetary']">
                                                                <t t-esc="company.currency_id.symbol"/>
                                                            </t>
                                                        </th>
                                                        <th style="width:30%;text-align:right;">Completeness</th>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="5" style="height:1px;background-color:#9A6C8E;"/>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <t t-foreach="line['goals']" t-as="goal">
                                                        <tr>
                                                            <t t-set="tdBgColor" t-value="'&#35;fff'"/>
                                                            <t t-set="tdColor" t-value="gray"/>
                                                            <t t-set="mutedColor" t-value="'&#35;AAAAAA'"/>
                                                            <t t-set="tdPercentageColor" t-value="'&#35;9A6C8E'"/>
                                                            <td width="10%" align="center" valign="middle" t-attf-style="background-color:#{tdBgColor};padding :5px 0;font-size:20px;"><t t-esc="goal['rank']+1"/>
                                                            </td>
                                                            <td width="15%" align="left" valign="middle" t-attf-style="background-color:#{tdBgColor};padding :5px 0;font-size:13px;"><t t-esc="goal['name']"/></td>
                                                            <td width="20%" align="right" t-attf-style="background-color:#{tdBgColor};padding:5px 0;line-height:1;"><t t-esc="'%.2f' % goal['current']"/><br/><span t-attf-style="font-size:13px;color:#{mutedColor};">on <t t-esc="'%.2f' % line['target']"/></span>
                                                            </td>
                                                            <td width="20%" t-attf-style="color:#{tdPercentageColor};background-color:#{tdBgColor};padding-right:15px;font-size:22px;" align="right"><strong><t t-esc="goal['completeness'] | int"/>%</strong></td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="5" style="height:1px;background-color:#DADADA;"/>
                                                        </tr>
                                                    </t>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </t>
                    </td></tr>
                </table>
                <table cellspacing="0" cellpadding="0" width="100%" style="padding: 15px; color: #666666;margin-bottom: 5px;">
                    <tr>
                        <td align="center" style="min-width: 590px;">
                            <table width="580" border="0" cellpadding="0" style="min-width: 580px; font-size: 12px;">
                                <tr>
                                    <td valign="middle" align="left" style="padding-top: 10px; padding-bottom: 10px;">
                                        <t t-esc="company.name"/><br/>
                                        <t t-esc="company.phone or ''"/>
                                    </td>
                                    <td valign="middle" align="right" style="padding-top: 10px; padding-bottom: 10px;">
                                        <t t-if="company.email">
                                            <a t-attf-href="mailto:#{company.email}" style="text-decoration:none; color: #666666;"><t t-esc="company.email"/></a><br/>
                                        </t>
                                        <t t-if="company.website">
                                            <a t-att-href="company.website" style="text-decoration:none; color: #666666;">
                                                <t t-esc="company.website"/>
                                            </a>
                                        </t>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr> 
                    <tr>
                        <td align="center">
                            Powered by <a target="_blank" href="https://www.odoo.com">Odoo</a>.
                        </td>
                    </tr>
                </table>
            </td></tr>
        </table>
    </td>
</tr>
</table>
</field></record>

        <!-- goal definitions -->
        <record model="gamification.goal.definition" id="definition_base_timezone">
            <field name="name">Set your Timezone</field>
            <field name="description">Configure your profile and specify your timezone</field>
            <field name="computation_mode">count</field>
            <field name="display_mode">boolean</field>
            <field name="model_id" eval="ref('base.model_res_users')" />
            <field name="domain">[('id','=',user.id),('partner_id.tz', '!=', False)]</field>
            <field name="action_id" eval="ref('base.action_res_users_my')" />
            <field name="res_id_field">user.id</field>
        </record>

        <record model="gamification.goal.definition" id="definition_base_company_data">
            <field name="name">Set your Company Data</field>
            <field name="description">Write some information about your company (specify at least a name)</field>
            <field name="computation_mode">count</field>
            <field name="display_mode">boolean</field>
            <field name="model_id" eval="ref('base.model_res_company')" />
            <field name="domain">[('user_ids', 'in', [user.id]), ('name', '=', 'YourCompany')]</field>
            <field name="condition">lower</field>
            <field name="action_id" eval="ref('base.action_res_company_form')" />
            <field name="res_id_field">user.company_id.id</field>
        </record>

        <record model="gamification.goal.definition" id="definition_base_company_logo">
            <field name="name">Set your Company Logo</field>
            <field name="computation_mode">count</field>
            <field name="display_mode">boolean</field>
            <field name="model_id" eval="ref('base.model_res_company')" />
            <field name="domain">[('user_ids', 'in', user.id),('logo', '!=', False)]</field>
            <field name="action_id" eval="ref('base.action_res_company_form')" />
            <field name="res_id_field">user.company_id.id</field>
        </record>

        <record id="action_new_simplified_res_users" model="ir.actions.act_window">
            <field name="name">Create User</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.users</field>
            <field name="view_type">form</field>
            <field name="target">current</field>
            <field name="view_id" ref="base.view_users_simple_form"/>
            <field name="context">{}</field>
            <field name="help">Create and manage users that will connect to the system. Users can be deactivated should there be a period of time during which they will/should not connect to the system. You can assign them groups in order to give them specific access to the applications they need to use in the system.</field>
        </record>

        <record model="gamification.goal.definition" id="definition_base_invite">
            <field name="name">Invite new Users</field>
            <field name="description">Create at least another user</field>
            <field name="display_mode">boolean</field>
            <field name="computation_mode">count</field>
            <field name="model_id" eval="ref('base.model_res_users')" />
            <field name="domain">[('id', '!=', user.id)]</field>
            <field name="action_id" eval="ref('action_new_simplified_res_users')" />
        </record>

        <record model="gamification.goal.definition" id="definition_nbr_following">
            <field name="name">Mail Group Following</field>
            <field name="description">Follow mail.channels to receive news</field>
            <field name="computation_mode">python</field>
            <field name="compute_code">result = env['mail.followers'].search_count([('res_model', '=', 'mail.channel'), ('partner_id', '=', object.user_id.partner_id.id)])</field>
            <field name="action_id" eval="ref('mail.mail_channel_action_view')" />
        </record>


        <!-- challenges -->
        <record model="gamification.challenge" id="challenge_base_discover">
            <field name="name">Complete your Profile</field>
            <field name="period">once</field>
            <field name="visibility_mode">personal</field>
            <field name="report_message_frequency">never</field>
            <field name="user_domain" eval="str([('groups_id.id', '=', ref('base.group_user'))])" />
            <field name="state">inprogress</field>
            <field name="category">other</field>
        </record>

        <record model="gamification.challenge" id="challenge_base_configure">
            <field name="name">Setup your Company</field>
            <field name="period">once</field>
            <field name="visibility_mode">personal</field>
            <field name="report_message_frequency">never</field>
            <field name="user_domain" eval="str([('groups_id.id', '=', ref('base.group_erp_manager'))])" />
            <field name="state">inprogress</field>
            <field name="category">other</field>
        </record>

        <!-- lines -->
        <record model="gamification.challenge.line" id="line_base_discover1">
            <field name="definition_id" eval="ref('definition_base_timezone')" />
            <field name="target_goal">1</field>
            <field name="challenge_id" eval="ref('challenge_base_discover')" />
        </record>

        <record model="gamification.challenge.line" id="line_base_admin2">
            <field name="definition_id" eval="ref('definition_base_company_logo')" />
            <field name="target_goal">1</field>
            <field name="challenge_id" eval="ref('challenge_base_configure')" />
        </record>
        <record model="gamification.challenge.line" id="line_base_admin1">
            <field name="definition_id" eval="ref('definition_base_company_data')" />
            <field name="target_goal">0</field>
            <field name="challenge_id" eval="ref('challenge_base_configure')" />
        </record>
        <record model="gamification.challenge.line" id="line_base_admin3">
            <field name="definition_id" eval="ref('definition_base_invite')" />
            <field name="target_goal">1</field>
            <field name="challenge_id" eval="ref('challenge_base_configure')" />
        </record>
    </data>

</odoo>
