<?xml version="1.0" encoding="UTF-8"?>
<Invoice 
    xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
    xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
    xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
    <cac:Party>
        {% if party.website %}<cbc:WebsiteURI>{{ party.website }}</cbc:WebsiteURI>{% endif %}
        <cac:PartyName>
            <cbc:Name>{{ party.name }}</cbc:Name>
        </cac:PartyName>
        {% if party.lang %}
        <cac:Language>
            <cbc:LocaleCode>{{ party.lang }}</cbc:LocaleCode>
        </cac:Language>
        {% endif %}
        <cac:PostalAddress>
            {% if party.street %}<cbc:StreetName>{{ party.street }}</cbc:StreetName>{% endif %}
            {% if party.street2 %}<cbc:AdditionalStreetName>{{ party.street2 }}</cbc:AdditionalStreetName>{% endif %}
            {% if party.city %}<cbc:CityName>{{ party.city }}</cbc:CityName>{% endif %}
            {% if party.zip %}<cbc:PostalZone>{{ party.zip }}</cbc:PostalZone>{% endif %}
            {% if party.state_id %}
            <cbc:CountrySubentity>{{ party.state_id.name }}</cbc:CountrySubentity>
            <cbc:CountrySubentityCode>{{ party.state_id.code }}</cbc:CountrySubentityCode>
            {% endif %}
            {% if party.country_id %}
            <cac:Country>
                <cbc:IdentificationCode>{{ party.country_id.code }}</cbc:IdentificationCode>
                <cbc:Name>{{ party.country_id.name }}</cbc:Name>
            </cac:Country>
            {% endif %}
        </cac:PostalAddress>
        {% if party.vat %}
        <cac:PartyTaxScheme>
            <cbc:RegistrationName>{{ party.name }}</cbc:RegistrationName>
            <cbc:CompanyID>{{ party.sanitized_vat }}</cbc:CompanyID>
            {% for unece_code_tax_id in party.unece_code_tax_ids %}
            <cac:TaxScheme>
                <cbc:ID 
                schemeID="{{ unece_code_tax_id.type_id.name }}" 
                schemeAgencyID="{{ unece_code_tax_id.type_id.agency_id.code }}"
                >{{ unece_code_tax_id.code }}</cbc:ID>
            </cac:TaxScheme>
            {% endfor %}
        </cac:PartyTaxScheme>
        {% endif %}      
        <cac:Contact>
            <cbc:Name>{{ party.name }}</cbc:Name>
            {% if party.phone %}<cbc:Telephone>{{ party.phone }}</cbc:Telephone>{% endif %}
            {% if party.fax %}<cbc:Telefax>{{ party.fax }}</cbc:Telefax>{% endif %}
            {% if party.email %}<cbc:ElectronicMail>{{ party.email }}</cbc:ElectronicMail>{% endif %}
        </cac:Contact>
    </cac:Party>
</Invoice>