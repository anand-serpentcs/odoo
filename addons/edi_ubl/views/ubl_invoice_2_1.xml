<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- The invoice template according to UBL v2.1 -->
        
        <template id="ubl_invoice_line">
            <cbc__ID t-esc="self.id"/>
            <cbc__UUID t-if="self.uuid" t-esc="self.uuid"/>
            <cbc__Note 
                t-foreach="self.notes"
                t-as="note"
                t-esc="note"/>
            <cbc__InvoicedQuantity t-esc="self.quantity"/>
            <cbc__LineExtensionAmount
                t-att-currencyID="currency_name"
                t-esc="self.subtotal"/>
            <cac__TaxTotal 
                t-foreach="self.taxes"
                t-as="tax"
                t-call="edi_ubl.ubl_tax_total">
                <t t-set="self" t-value="tax"/>
            </cac__TaxTotal>
            <cac__Item t-call="edi_ubl.ubl_item">
                <t t-set="self" t-value="self.item"/>
            </cac__Item>
            <cac__Price t-call="edi_ubl.ubl_price"/>
        </template>

        <template id="ubl_invoice">
            <Invoice
                t-att="{
                    'xmlns': 'urn:oasis:names:specification:ubl:schema:xsd:Invoice-2',
                    'xmlns:cac': 'urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2',
                    'xmlns:cbc': 'urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2'}">
                <cbc__UBLVersionID t-esc="version_id"/>
                <cbc__ID t-esc="id"/>
                <cbc__UUID t-if="uuid" t-esc="uuid"/>
                <cbc__IssueDate t-esc="issue_date"/>
                <cbc__InvoiceTypeCode t-esc="type_code"/>
                <cbc__Note 
                    t-foreach="notes"
                    t-as="note"
                    t-esc="note"/>
                <cbc__DocumentCurrencyCode t-esc="currency_name"/>
                <cac__AdditionalDocumentReference 
                    t-call="edi_ubl.ubl_document_reference">
                    <t t-set="self" t-value="doc_ref"/>
                </cac__AdditionalDocumentReference>
                <cac__AccountingSupplierParty t-call="edi_ubl.ubl_party">
                        <t t-set="self" t-value="supplier_party"/>
                </cac__AccountingSupplierParty>
                <cac__AccountingCustomerParty t-call="edi_ubl.ubl_party">
                        <t t-set="self" t-value="customer_party"/>
                </cac__AccountingCustomerParty>
                <cac__PaymentMeans
                    t-foreach="payment_means" 
                    t-as="payment_mean"
                    t-call="edi_ubl.ubl_payment_means">
                    <t t-set="self" t-value="payment_mean"/>
                </cac__PaymentMeans>
                <cac__TaxTotal 
                    t-call="edi_ubl.ubl_tax_total">
                    <t t-set="self" t-value="tax_total"/>
                </cac__TaxTotal>
                <cac__LegalMonetaryTotal 
                    t-call="edi_ubl.ubl_monetary_total">
                    <t t-set="self" t-value="monetary"/>
                </cac__LegalMonetaryTotal>
                <cac__InvoiceLine 
                    t-foreach="invoice_lines" 
                    t-as="invoice_line"
                    t-call="edi_ubl.ubl_invoice_line">
                        <t t-set="self" t-value="invoice_line"/>
                </cac__InvoiceLine>
            </Invoice>
        </template>
    </data>
</odoo>