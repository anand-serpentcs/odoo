<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- The various subtemplates from the CommonAggregateComponents -->

        <template id="ubl_attachment">
            <cbc__EmbeddedDocumentBinaryObject 
                mimeCode="application/pdf"
                t-esc="self.attach_binary"/>
        </template>

        <template id="ubl_document_reference">
            <cbc__ID t-esc="self.doc_ref_id"/>
            <cac__Attachment t-call="edi_ubl.ubl_attachment"/>
        </template>

        <template id="ubl_party_name">
            <cbc__Name t-esc="self.name"/>
        </template>

        <template id="ubl_language">
            <cbc__LocaleCode t-esc="self.lang"/>
        </template>

        <template id="ubl_country">
            <cbc__IdentificationCode t-esc="self.code"/> 
            <cbc__Name t-esc="self.name"/> 
        </template>

        <template id="ubl_address">
            <cbc__StreetName 
                t-if="get(self, 'street')" 
                t-esc="self.street"/>
            <cbc__AdditionalStreetName
                t-if="get(self, 'street2')" 
                t-esc="self.street2"/>
            <cbc__CityName 
                t-if="get(self, 'city')" 
                t-esc="self.city"/>
            <cbc__PostalZone 
                t-if="get(self, 'zip')" 
                t-esc="self.zip"/>
            <cbc__CountrySubentity 
                t-if="get(self, 'state_id')" 
                t-esc="self.state_id.name"/>
            <cbc__CountrySubentityCode 
                t-if="get(self, 'state_id')" 
                t-esc="self.state_id.code"/>
            <cac__Country 
                t-if="get(self, 'country_id')"
                t-call="edi_ubl.ubl_country">
                    <t t-set="self" t-value="self.country_id"/>
            </cac__Country>
        </template>

        <template id="ubl_tax_scheme">
            <cbc__ID 
                t-att-schemeID="self.type_id.name" 
                t-att-schemeAgencyID="self.type_id.agency_id.code"
                t-esc="self.code"/>
        </template>

        <template id="ubl_party_tax_scheme">
            <cbc__RegistrationName t-esc="self.name"/>
            <cbc__CompanyID t-esc="self.sanitized_vat"/>
            <cbc__TaxScheme 
                t-foreach="self.unece_code_tax_ids" 
                t-as="unece_code"
                t-call="ubl_tax_scheme">
                <t t-set="self" t-value="unece_code"/>
            </cbc__TaxScheme>
        </template>

        <template id="ubl_contact">
            <cbc__Name t-esc="self.name"/>
            <cbc__Telephone 
                t-if="get(self, 'phone')" 
                t-esc="self.phone"/>
            <cbc__Telefax 
                t-if="get(self, 'fax')" 
                t-esc="self.fax"/>
            <cbc__ElectronicMail 
                t-if="get(self, 'email')" 
                t-esc="self.email"/>
        </template>

        <template id="ubl_party">
            <cac__Party>
                <cbc__WebsiteURI
                    t-if="get(self, 'website')"
                    t-esc="self.website"/>
                <cac__PartyName 
                    t-call="edi_ubl.ubl_party_name"/>
                <cac__Language 
                    t-if="get(self, 'lang')" 
                    t-call="edi_ubl.ubl_language"/>
                <cac__PostalAddress 
                    t-call="edi_ubl.ubl_address"/>
                <cac__PartyTaxScheme 
                    t-if="get(self, 'vat')"
                    t-call="edi_ubl.ubl_party_tax_scheme"/>
                <cac__Contact>
                    <t t-call="edi_ubl.ubl_contact"/>
                </cac__Contact>
            </cac__Party>
        </template>

        <template id="ubl_payment_means">
            <cbc__PaymentMeansCode 
                t-att-listID="self.unece_code.type_id.name"
                t-att-listAgencyID="self.unece_code.type_id.agency_id.code"
                t-esc="self.unece_code.code"/>
            <cbc__PaymentDueDate
                t-esc="self.date_due"/>
        </template>

        <template id="ubl_tax_category">
            <cbc__ID
                t-if="get(self, 'unece_code')"
                t-att-schemeID="self.unece_code.type_id.name"
                t-att-schemeAgencyID="self.unece_code.type_id.agency_id.code"
                t-esc="self.unece_code.code"/>
            <cbc__Name 
                t-if="get(self, 'tax_name')"
                t-esc="self.tax_name"/>
            <cbc__Percent
                t-if="get(self, 'tax_percent')"
                t-esc="self.tax_percent"/>
            <cac__TaxScheme
                t-call="edi_ubl.ubl_tax_scheme">
                <t t-set="self" t-value="self.unece_code"/>
            </cac__TaxScheme>
        </template>

        <template id="ubl_tax_subtotal">
            <cbc__TaxableAmount
                t-if="get(self, 'taxable_amount')"
                t-esc="self.taxable_amount"
                t-att-currencyID="currency_name"/>
            <cbc__TaxAmount 
                t-att-currencyID="currency_name"
                t-esc="self.amount_tax"/>
            <cac__TaxCategory
                t-call="edi_ubl.ubl_tax_category"/>
        </template>

        <template id="ubl_tax_total">
            <cbc__TaxAmount 
                t-att-currencyID="currency_name"
                t-esc="self.amount_tax"/>
            <t t-if="get(self, 'taxes')">
                <t 
                    t-foreach="self.taxes"
                    t-as="tax">
                    <t t-if="get(taxes, 'unece_code')">
                        <cac__TaxSubtotal
                            t-call="edi_ubl.ubl_tax_subtotal">
                                <t t-set="self" t-value="tax"/>
                        </cac__TaxSubtotal>
                    </t>
                </t>
            </t>
            <t t-elif="get(self, 'unece_code')">
                <cac__TaxSubtotal
                    t-call="edi_ubl.ubl_tax_subtotal"/>
            </t>
        </template>

        <template id="ubl_monetary_total">
            <cbc__LineExtensionAmount 
            t-att-currencyID="currency_name"
            t-esc="self.amount_untaxed"/>
            <cbc__TaxExclusiveAmount 
            t-att-currencyID="currency_name"
            t-esc="self.amount_untaxed"/>
            <cbc__TaxInclusiveAmount 
            t-att-currencyID="currency_name"
            t-esc="self.amount_total"/>
            <cbc__PrepaidAmount 
            t-att-currencyID="currency_name"
            t-esc="self.amount_prepaid"/>
            <cbc__PayableAmount 
            t-att-currencyID="currency_name"
            t-esc="self.residual"/>
        </template>

        <template id="ubl_item_identification">
            <cbc__ID t-esc="identification_id"/>
        </template>

        <template id="ubl_item_property">
            <cbc__Name t-esc="property_name"/>
            <cbc__Value t-esc="property_value"/>
        </template>

        <template id="ubl_item">
            <cbc__Description t-esc="self.description"/>
            <cbc__Name t-esc="self.name"/>
            <cac__SellersItemIdentification
                t-if="get(self, 'identification_id')"
                t-call="edi_ubl.ubl_item_identification">
                <t t-set="identification_id" t-value="self.identification_id"/>
            </cac__SellersItemIdentification>
            <cac__AdditionalItemProperty 
                t-foreach="self.product_id.attribute_value_ids"
                t-as="attribute_value_id">
                <t t-call="edi_ubl.ubl_item_property">
                    <t 
                        t-set="property_name"
                        t-value="attribute_value_id.attribute_id.name"/>
                    <t 
                        t-set="property_value"
                        t-value="attribute_value_id.name"/>
                </t>
            </cac__AdditionalItemProperty>
        </template>

        <template id="ubl_price">
            <cbc__PriceAmount 
                t-att-currencyID="currency_name"
                t-esc="self.subtotal"/>
            <cbc__BaseQuantity t-esc="self.quantity"/>
        </template>
    </data>
</odoo>